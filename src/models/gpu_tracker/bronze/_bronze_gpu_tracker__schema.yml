version: 2

x-model-config: &model-config
  meta:
    dagster:
      group: gpu_tracker

x-product-columns: &product-columns
  - name: id
    data_tests:
      - not_null
      - unique
  - name: source_id
    data_tests:
      - not_null
  - name: domain_tld
    data_tests:
      - not_null
  - name: title
    data_tests:
      - not_null
  - name: description
    data_tests:
      - not_null
  - name: product_url
    data_tests:
      - not_null
  - name: source_created_at
    data_tests:
      - not_null
  - name: source_updated_at
    data_tests:
      - not_null
  - name: retrieved_at
    data_tests:
      - not_null
  - name: brand
    data_tests:
      - not_null
  - name: image_url
    data_tests:
      - not_null
  - name: price_min
    data_tests:
      - dbt_utils.accepted_range:
          min_value: 0
          inclusive: true
  - name: price_max
    data_tests:
      - dbt_utils.expression_is_true:
          expression: ">= price_min"
  - name: variants
    data_tests:
      - not_null

x-variant-columns: &variant-columns
  - name: id
    data_tests:
      - not_null
      - unique
  - name: source_id
    data_tests:
      - not_null
  - name: product_id
    data_tests:
      - not_null
  - name: domain_tld
    data_tests:
      - not_null
  - name: title
    data_tests:
      - not_null
  - name: is_available
    data_tests:
      - not_null
  - name: price
    data_tests:
      - dbt_utils.accepted_range:
          min_value: 0
          inclusive: true
  - name: weight
    data_tests:
      - dbt_utils.accepted_range:
          min_value: 0
          inclusive: true
  - name: retrieved_at
    data_tests:
      - not_null

models:
  - name: gpu_tracker__dynaquest_products_bronze
    config: *model-config
    columns: *product-columns

  - name: gpu_tracker__datablitz_products_bronze
    config: *model-config
    columns: *product-columns

  - name: gpu_tracker__dynaquest_variants_bronze
    config: *model-config
    columns: *variant-columns

  - name: gpu_tracker__datablitz_variants_bronze
    config: *model-config
    columns: *variant-columns
